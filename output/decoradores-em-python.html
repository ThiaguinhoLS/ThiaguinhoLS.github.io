<!doctype html>
<html lang="">    
    <head>
        <meta http-equiv="Content-Type" content="text/html" charset="UTF-8" />
        <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
        <title>
        Diário de um programador
        </title>
        <meta name="description" content="" />
        <link href='//fonts.googleapis.com/css?family=Open+Sans:300italic,700italic,300,700' rel='stylesheet' type='text/css'>
        <link href='//fonts.googleapis.com/css?family=Bree+Serif' rel='stylesheet' type='text/css'>
        <link href="//netdna.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.css" rel="stylesheet">
        <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/8.4/styles/default.min.css">

        <link rel="stylesheet" type="text/css" href="/theme/css/crisp.css" />
        <link rel="stylesheet" type="text/css" href="/theme/css/tango.css" />
        <link rel="stylesheet" type="text/css" href="/theme/css/styles.css" />

        <meta charset="utf-8" />

        <meta name="HandheldFriendly" content="True" />
        <meta name="MobileOptimized" content="320" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
            <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
            <!--[if lt IE 9]>
                <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
                <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
            <![endif]--> 
 

<link rel="stylesheet" type="text/css" href="/theme/css/rrssb.css">
<meta property="og:title" content="Decoradores em Python" />
<meta property="og:type" content="Python" />
    </head>
    <body>
        <header id="header">
            <h1><a href="/">Diário de um programador </a></h1>
            <p></p>
            <div id="follow-icons">
                <a href="https://pt.stackoverflow.com/users/88315/thiagoluizs"><i class="fa fa-stack-overflow-square fa-2x"></i></a>
                <a href="https://github.com/ThiaguinhoLS/"><i class="fa fa-github-square fa-2x"></i></a>
                <a href="https://twitter.com/ThiaguinhoLS3"><i class="fa fa-twitter-square fa-2x"></i></a>
                <a href="thiagoluizs@yahoo.com"><i class="fa fa-facebook-square fa-2x"></i></a>
            </div>         

        </header>
        <main id="content">
<article class="post-article">
    <div class="post-stamp">
    julho 24 2018
    <span class="taglist">
            <a href="/tag/python.html"> &middot; python</a>
    </span>
    </div>

    <h1 class="post-title">Decoradores em Python</h1>
    <h2>O que são decoradores?</h2>
<p>Um <em>decorador</em> nada mais é do que uma função/método ou qualquer objeto <em>Callable</em> que recebe como argumento um objeto que também seja um <em>Callable</em> acrescentando ao mesmo alguma funcionalidade, fazendo alguma verificação, ou qualquer coisa que você ache que deva fazer antes de realmente chamar a função em si. Vamos ver um pouco de código.</p>
<div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">add</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">a</span> <span class="o">+</span> <span class="n">b</span>

<span class="k">def</span> <span class="nf">sub</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">a</span> <span class="o">-</span> <span class="n">b</span>
</pre></div>


<p>Digamos que queremos implementar um sistema de log nessas funções faríamos assim:</p>
<div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">logging</span>

<span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">()</span>
<span class="n">logger</span><span class="o">.</span><span class="n">setLevel</span><span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">DEBUG</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">add</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;Função add chamada&#39;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">a</span> <span class="o">+</span> <span class="n">b</span>

<span class="k">def</span> <span class="nf">sub</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;Função sub chamada&#39;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">a</span> <span class="o">-</span> <span class="n">b</span>
</pre></div>


<p>Acrescentamos log somente a nível de depuração nas duas funções até aí nada de mais mas e se criamos as funções <em>div</em>, <em>mul</em>, ou outras? Teríamos duplicação de código em todas elas, então qual seria a melhor abordagem aqui? Se você respondeu decoradores acertou em cheio. Com o uso de decoradores podemos extrair a funcionalidade comum e deixá-la a cargo do decorador, enquanto a parte variante inplementamos na própria função.</p>
<div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">logging</span>

<span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">()</span>

<span class="k">def</span> <span class="nf">decorator</span><span class="p">(</span><span class="n">func</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">wrapper</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;Função {} chamada&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">func</span><span class="o">.</span><span class="vm">__name__</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">wrapper</span>

<span class="nd">@decorator</span>
<span class="k">def</span> <span class="nf">add</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">a</span> <span class="o">+</span> <span class="n">b</span>

<span class="nd">@decorator</span>
<span class="k">def</span> <span class="nf">sub</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">a</span> <span class="o">-</span> <span class="n">b</span>
</pre></div>


<p>Agora não importa quantas funções eu queira adicionar a funcionalidade do log, somente preciso utilizar meu decorador e pronto, a mesma agora possui essa funcionalidade.</p>
<p>Vamos fazer algumas verificações nesse código.</p>
<div class="highlight"><pre><span></span><span class="o">&gt;&gt;&gt;</span> <span class="n">add</span>
<span class="o">&lt;</span><span class="n">function</span> <span class="n">decorator</span><span class="o">.&lt;</span><span class="nb">locals</span><span class="o">&gt;.</span><span class="n">wrapper</span> <span class="n">at</span> <span class="mh">0x7f259e64d9d8</span><span class="o">&gt;</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">add</span><span class="o">.</span><span class="vm">__name__</span>
<span class="s1">&#39;wrapper&#39;</span>
</pre></div>


<p>Pelo que podemos ver a função decorada perdeu digamos assim sua <em>"identidade"</em>, mas se olharmos novamente nosso código poderemos rapidamente descobrir o motivo não é mesmo? O motivo é que quando decoramos a função estamos chamando o decorador e passando como argumento essa função da seguinte forma:</p>
<div class="highlight"><pre><span></span><span class="n">add</span> <span class="o">=</span> <span class="n">decorator</span><span class="p">(</span><span class="n">add</span><span class="p">)</span> <span class="c1"># O mesmo que utilizar @decorator acima da definição da função</span>
</pre></div>


<p>A função <em>decorator</em> está sendo executada com o parâmetro <em>func</em> sendo a função <em>add</em>, depois o decorador define um função aninhada(interna) chamada <em>wrapper</em>, e retorna a mesma, ou seja, a função retornada não é a mesma que foi decorada mas sim um invólucro. Um meio de contornar a perda desses atributos, caso você necessite deles para realizar introspecção, ou qualquer que seja o motivo é utilizar a função <em><a href="https://docs.python.org/3/library/functools.html#functools.wraps" target="_blank">wraps</a></em> que acreditem ou não é um decorador.</p>
<div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">functools</span> <span class="kn">import</span> <span class="n">wraps</span>

<span class="k">def</span> <span class="nf">decorator</span><span class="p">(</span><span class="n">func</span><span class="p">):</span>
    <span class="nd">@wraps</span><span class="p">(</span><span class="n">func</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">wrapper</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">func</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">wrapper</span>
</pre></div>


<p>Agora se fizermos:</p>
<div class="highlight"><pre><span></span><span class="o">&gt;&gt;&gt;</span> <span class="n">add</span> <span class="o">=</span> <span class="n">decorator</span><span class="p">(</span><span class="n">add</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">add</span>
<span class="o">&lt;</span><span class="n">function</span> <span class="n">add</span> <span class="n">at</span> <span class="mh">0x7f125611dae8</span><span class="o">&gt;</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">add</span><span class="o">.</span><span class="vm">__name__</span>
<span class="s1">&#39;add&#39;</span>
</pre></div>


<p>Espero ter ajudado nem mesmo que seja um pouco no seu entendimento sobre decoradores, qualquer dúvida deixe nos comentários que tentarei responde-lá da melhor forma possível.</p>
<div id="comments">
    <div id="disqus_thread"></div>
<script>

var disqus_config = function () {
this.page.url = '/decoradores-em-python.html'; 
this.page.identifier = 'decoradores-em-python'; 
};

(function() { // DON'T EDIT BELOW THIS LINE
var d = document, s = d.createElement('script');

s.src = '//diariodeumprogramador.disqus.com/embed.js';

s.setAttribute('data-timestamp', +new Date());
(d.head || d.body).appendChild(s);
})();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript>
</div>
</article> 

        </main>

        <footer id="footer">
            <section id="footer-message">&copy; ThiaguinhoLS . All rights reserved. Powered by <a href="http://blog.getpelican.com/" target="_blank">Pelican</a>. Theme: <a href="https://github.com/kathyqian/crisp-ghost-theme" target="_blank">Crisp</a>.</section>
        </footer>
    <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/8.4/highlight.min.js"></script>
    <script>hljs.initHighlightingOnLoad();</script>
    </body>
</html>